var express = require('express');
var router = express.Router();
var utils = require('../lib/utils.js')
var cors = require('./cors')
var tokenSDKServer = require('token-sdk-server')
var fs = require('fs')
const Base64 = require('js-base64').Base64


// var session = require('express-session');
// var FileStore = require('session-file-store')(session)

// function fn (first, second = {k0: '0', k1: 1}) {
//   console.log('first', first)
//   console.log('second', second)
//   console.log('k0', second.k0)
//   console.log('k1', second.k1)
// }

/* GET users listing. */
router.route('/test')
  .options(cors.corsWithOptions, (req, res) => {
    res.sendStatus(200)
  })
  .get(cors.corsWithOptions, (req, res, next) =>{
    // 测试远端的pvdata
    let {didttm, idpwd} = require('../tokenSDKData/privateConfig.js')//.didttm.did
    let priStr = JSON.parse(tokenSDKServer.decryptDidttm(didttm, idpwd).data).prikey // 0xcf0fbbdac3353253cec457a81a560d916bfb229a710774747e29f0ff1c1daa59
    tokenSDKServer.getPvData


    // // 测试备份父did的待办事项 list
    // let key = '0x' + tokenSDKServer.hashKeccak256(`did:ttm:u011b80743b5fa85ade3a5696eef660b2bae1ba4ba2b84938f26f024cf3fcdgo to check businessLicense`)
    // tokenSDKServer.pullData(key, false).then(response => {
    //   console.log(response.data)
    //   res.status(200).json({
    //     result: true,
    //     message: '',
    //     data: JSON.parse(response.data.result.data)
    //   })
    // })
    
    // // 测试备份的数据是什么样的。
    // let a = '0x59a955b5178198e52052f1e588da785eeb0c8e10b3e3000c86773c4bddb70089'
    // let b = '0xc26560700a7c0b50937acb7eb9134132c3ce009e5c1780cb769ce58ee17a20f3'
    // tokenSDKServer.getTemporaryCertifyData(a).then(respons => {
    //   console.log(respons.data)
    //   tokenSDKServer.getTemporaryCertifyData(b).then(respons => {
    //     console.log(respons.data)
    //   })
    // }).catch(error => {
    //   console.log(error)
    // })

    // 测试默认参数
    // fn('str')


    // 测试验签
    // let {didttm, idpwd} = require('../tokenSDKData/privateConfig.js')//.didttm.did
    // let priStr = JSON.parse(tokenSDKServer.decryptDidttm(didttm, idpwd).data).prikey // 0xcf0fbbdac3353253cec457a81a560d916bfb229a710774747e29f0ff1c1daa59
    // let obj = {
    //   "businessLicenseData": {
    //     "applicantDid": "did:ttm:o085219a4ead4ff8ebdbad72bc99bbf9dc47cd2f9ae9800998ecf8427e4a13",
    //     "applicantSuperDid": "did:ttm:u011b80743b5fa85ade3a5696eef660b2bae1ba4ba2b84938f26f024cf3fcd",
    //     "claim_sn": "0x49ac373cca54410f4570540bb5925947bfd931bf5def21ee143774a924d55508",
    //     "createTime": "1594864821000",
    //     "ocrData": {
    //       "unifiedSocialCreditCode": "91110108MA01BM825Q",
    //       "name": "北京投肯科技有限公司",
    //       "type": "其他有限责任公司",
    //       "residence": "北京市海淀区永澄北路2号院1号楼B座三层30099-244号",
    //       "legalRepresentative": "蔡明军",
    //       "registeredCapital": "621.7722万元",
    //       "dateOfEstablishment": "2018年04月23日",
    //       "operatingPeriod": "2068年04月22日",
    //       "businessScope": "数据处理旧(数据处理中的银行卡后不含立务承办展示活动组权文化艺术交流旧值在14以上的云计算数据中除外)(企业依法自主选择经营项目开展经营活动依法l须经批准的项目经相关部门批准后依批准的内容开展经营活动不得从事本市产业政策禁止和限制类项目的政管登记机关★在线扫码获取详细信息G提示每年1月1日至6月30日通过企业信用信息公示系统报送上一年度年度报告并公2018Goncocnacnanoaucuacn",
    //       "registrationAuthority": "北京市工商行政管理局",
    //       "businessLicense": "0x3d60ae00b09686201e845632da3a40c818836e2eb8fdb70abe073b2772e3da24",
    //       "longitude": "116.653648",
    //       "latitude": "40.12218",
    //       "applicantBankAccountName": "百度科技",
    //       "applicantBankName": "北京银行",
    //       "applicantBankAccountNumber": "6469494646",
    //       "receiveBankName": "北京银行",
    //       "receiveBankAccountName": "北京投肯科技",
    //       "receiveBankAccountNumber": "88888888888888888888",
    //       "verificationMoney": "0.13元"
    //     }
    //   },
    //   "sign": "0x4b6db5053f63939cad904da1fbf8cc5c809f8477d6c3938c6048c3bf61ecd8b623c5d7a2f5402951f380f4b668d1dc1084b82ea7bfffa838e638fd992e1f2e6101"
    // }
    // let signObj = JSON.stringify(obj)
    // let hashStr = tokenSDKServer.hashKeccak256(obj)
    // console.log('hashStr', hashStr)
    // hashStr = '0x9d25d6990ab6068fab344d7f07bbb7173ff89ad0967327febaa420214f9fda44'
    // let signData = tokenSDKServer.sign({keys: priStr, msg: hashStr})
    // console.log('signData', signData)
    // let signData = '0x4b6db5053f63939cad904da1fbf8cc5c809f8477d6c3938c6048c3bf61ecd8b623c5d7a2f5402951f380f4b668d1dc1084b82ea7bfffa838e638fd992e1f2e6101'
    // signData = '0x4b6db5053f63939cad904da1fbf8cc5c809f8477d6c3938c6048c3bf61ecd8b623c5d7a2f5402951f380f4b668d1dc1084b82ea7bfffa838e638fd992e1f2e6127'
    // signData = '0x4b6db5053f63939cad904da1fbf8cc5c809f8477d6c3938c6048c3bf61ecd8b623c5d7a2f5402951f380f4b668d1dc1084b82ea7bfffa838e638fd992e1f2e6128'
    // signData = '0x4b6db5053f63939cad904da1fbf8cc5c809f8477d6c3938c6048c3bf61ecd8b623c5d7a2f5402951f380f4b668d1dc1084b82ea7bfffa838e638fd992e1f2e61'
    // let isok = tokenSDKServer.verify({sign: signData})
    // // console.log('signData', signData)
    // console.log('isok', isok)





    // res.status(200).json({
    //   result: true,
    //   message: '',
    //   data: ''
    // })
  })
  .post(cors.corsWithOptions, (req, res, next) => {
    res.send('post')
  })
  .put(cors.corsWithOptions, (req, res, next) => {
    res.send('put')
  })
  .delete(cors.corsWithOptions, (req, res, next) => {
    res.send('delete')
  })

router.route('/setPvdata')
  .options(cors.corsWithOptions, (req, res) => {
    res.sendStatus(200)
  })
  .get(cors.corsWithOptions, (req, res, next) =>{
    res.send('get')
  })
  .post(cors.corsWithOptions, (req, res, next) => {
    let did = 'did:ttm:a0e01cb27c8e5160a907b1373f083af3d2eb64fd8ee9800998ecf8427eab11',
        privStr = '0xcf0fbbdac3353253cec457a81a560d916bfb229a710774747e29f0ff1c1daa59',
        key = '0xf1aa1f4416c5189d150eebf3a0bf1d514f2c35412a3523eb9e3af41375b96b74',
        originCt = '0x071684fb67ac6a14c199a746646ffb2219ffb3b492fc38ded66faa5f2775162b5298d98f51c11471ced383e631c2e26cdabf5422bf47e9147c10ac8390984ca1cfdef5a91758e3a14fc217cca0a7f2ed08ef8beca93f1ae112b40c393bdcb891ed0d28ebfecd85dfb810bdb449729fe1b274d2922542fdbfc05182009ad2d1ec64d518f5c77633a3e6fe4f4cea391edf3a07a7c099dc402c3740de8b8160e9404b8942b35cc8e483fd6478aca9d254c26352e88946fc1b634fff28fb0a18e8fc768a1a7c0d1d8162b8ffb6394a3cfd4f8cae64f73ca4cf10f47e8e0571d2b33a5f72bc3f7bd4aae680f705f620850a29311165f36a9f2f4bcecc42f1eb90125e544d0b7d991f4105241eb8d093d9c0b516941fd7cda24d4c452c75d5d63b32099252f39e9a54d8edce8526bf87beba986ad69ae4ec23f26183fd502803d42874bc587251305fd682f889569ad521ad43834b7ada8f1ade61c4618fcd733c51e93a923497a98667769aa640b9444f9a108813ef91b1f2389c9e2a4b92c8d51760f69a3bbec92b48c28e61e38396980ef8535d91d9b3c070573bea9d0f3b28125fc538c4731f01c8de0c2609b2708016936f02ae1dbc0124d06ad65a775c6f523083f5d01ae529c02a06095b9bc3b51aba6d40354cb8a45e1c1a53e732ae58be9e683d905167519f8fc200089ead3eec704fccd0ddd17c7bbffdc991a0043b03cdd42810c40da61a4857b497c820f5e42088f6423ced8a34c264105780943342be3345bb8cc73cf233ec3d6f91390f4ec902535bf18116dcfcc069e1651b6d33203df56a40dd7ce5a476c2c0eb19956f726f7b8c6944e86fbd477bfe3f2beebf7eeddbb79f77a1bff64a5af82f035dcc80fca63ac3d0375a7a6f1bf149596cb1a1fa035aef480be304da9ddd55ce07296366a2c1c8c8613d8c025f3aec11bf4416d015faabcb19c6d3db4f348842162c22b5fb601f5a90000980b1a866676cf5b08aa430e5a4c82344a29b2ca55527f860318e7979134544c0e23e52212ff7507750e0cce6ded6516c1bf32c49c290094c0555509f3019609c220ca45a7ce2a39c2b8edc9383fd4d496551e542cc14b32f8691d7b508e70619c44e6e6ce991fbb113ebd7b2c461e467a9a229535d21cc1f65a12e06485b8fc996c8a4d9d868481bef456184fa761183b5db702e1102043da7b8323864c5420e2286be1c50f58727437ed834d415545fc9d6a20d5ea13f05fe44eaff856a6b647d74bdbc220aaf0babf47ff7c2dc914decb189fddcb9577b69e84171d2a57f708cca14723dadbec6f09a508452ed8662ad92037a12fa398a169ec4a6378ddaf469f74fdb4610b7c1ba3f4901aefb0fe49c1d16a86e36255707ca30b424d992204d78509f14a7b98a8628248b91d0d6fa4382d3071ba4de40c7a4da8f0cf9425f2762d660542a635e9278def4b51f9839d3e5e63cbd9137c18182f0fe8d4cff6cf9e39c05caa20d705ae50e4fb4ff2de347faaf204606135c96a2b6e23bbce8c5b36cb1baec980cc07e00fb268da5d683511cd2f5cb000e88a608fd32194db13397644a965f9082f98bfdb2a2380de25a26a09ea54c64e58fa1c58ca9d7dd35cc9ef786d1f02c07e3beff6b5f823e73b7e9895a62af6790a7b498bc74112310b4becc9bbb46b603f52acb4569dc5219a24ea753d03dd06993e6dcc4ca6f97d5ee864805dcb165aeb40f7555e7ba86dc2659c6a681604ae74f8536e739ae7b4c51bd9c76d9d049278233a8cee73bef0f9a9dfd2109ca018b6657b0496a12f1684547526474d54eeb497a49d57a48930505e180052fb3a36686eca59d93a6d718e7d92d36e0a2b7c5ff60333a9c18f45547990b8af1875539f1c010c0a467d93c899af12f397c528f07f9f617b3cb6b38f4795c0e774ddc7d528dfac1187adbdff8f5d78a417ac8e07817a521fa505cf59451464b55429c1a03b9e035ec808862be7a3bce930bb16edd0b82d8f6bce7f1f23d8b09488f836100d49280a63461c884e240c942b92968fd2f91c5b10f1c4bdab636c2fe12e1d5cb2242afaf19b16eaf206e20d37cec5a2b912cb4eaa8be9ee72599ceebe29a6b087b942381dce3e243237c38eca2474f1b6cde10d7f7e4e02b816477db7190c050bdad402c6765f8628cad11209e558fe2b9b44db7d2f1fcae91a66088e7288640d54474c394b69d15bd9081a061248bc9a57fcdbdfbd0bde70b7fd11a35fa4c4e9aec8bcca749964e88a50d344db8d65f018b3cf69643928359e58b1fb3ebe681bf5f3c8cebc0cdc39f774fabf96278ba63d9a3ee84f6d312342a17793f1cce7ebdd350bf5dd3af8942ea884fef006851700cf57dd76f5c2297d34fb635f763e6ddbd0b26dafe74a6ce0463aa6b35ce5107ee51d80ff6a99084becc0838fe3e254626799414c3de64715205483105fbf3b057f6be888d37f686d83af5606b45e10ef271e68f5fa7a147577edf1e92194879cdeaa0310185b70e42bdf08bffbbe7ec63e55de8c54863d8ced69c6714cf550c9e17d618cbf232a74c38768d840020b3b85982cb10cf78e73aef7b4e686a174bfaacce85859d3f88ca43a8709eb83d3b9e216db3357c05ceeb2cc04dcfce58fdefcdc62780764e3895db8e4b681e133add988a36c66681899ad7c7f77ce88ad537408d5ee726a59a5b6ff8ef666351c9a8aea8fde3483af8f115819aa7f91c2ce7b0bb40137073c615cfac3c9ba6ae9281e7d1b1460a65e0e4c5e7c1eb001e60b3e72732a7f8d8fa8ae5aa17d9aaa5e330d592422ce38ea736086254d5ff4653c07e590f5f432eafae194421ec0e6d79342028e27ab19e6da6a18cb2aafeeda836b9b0aafd61b2243b80040e17191b9a3d1fa9dd5352ca22ef79305b74fc021d8930644a8640f1a68abdcdf6a984c5de577a9fd64211828b3beac0149393d52617c0145874dec60a34e6dcbb6e8a77a4a960de25474d1d6a69116c99495028390dc2a5bc719b489e12db2819b9046a9ea73b4291ab5854e18981af6f15c879096050cfdb82be2da541de1ccbf33999c7549817171a1aa10fbbbc7e715da21f4f94737fcf15d134b41559565b8c15ce85d0264f44aa89449dd48c715a35be2e17a8c4540932e4627be67a267f9742954e495f07c3b78f3158ceda9c606a6ff36b9f7a88213df8916364cbbb60120aa01909474a19d19371fa1617657e16ab70c701088fb1acb914ec033bb7a50f945d2ab337749d70133f84dd4bafb82029f3a64ed44fa19189a872833de99ebf75dc244de511db8433d24ee73ae0f014ba54a7d50af5e0a1c2fe9716be2fd78e0d315afe5ace7eaa6ad5c66f3df7487a51b3a58dccadad4d7fbd1be2d9d1f7a5f7b89c240e9994d5063e07d51ce4b1244077ce9fbcb9747e9485fec17b65488a21c4e4aea1a858695d172eff29b93495f8eab237312bc75c4ad3d6a9b1394881041bb9e56be3ffd68d226b0c732aee32df73d94f6af33c0d2cbb1a88fe29c1d41617d3e027162c4c9319aac62d5e0e1e1f36a831b82e2fb29e276099aa3ba05ac0ec7968786d84e2b7c4f8542730738f178500c37608c57d8ef48088e81b472f2c5cf35284748f416010cc02a78548ed55782fd69c864b1699dc662497cb32e1d722cc14632492b9c8978317c76fe94fd76c2b77a705e80f7f6267ee00c57c03feb0466243f9b37dbaf49f6acd08ca192715e076f86ac19810157362f2fd269925cf384748e01ae2879fe6a9d645e712637aec3e39369e6ab46c29e0255bfa0356b1adfbc00dac7653dad32c451499aa6a7aa54def57bddc05cca5df873119cca709b03d8f8e8296fa605d7cd26438c426906d38f205890b78831191ff6d06aebbb50374e5487d25d053c7916ccb57d31f11f2ac68258f3f0560d6ea8ec6564fb7de73d80e9fa394783ddb56f7f2032479607f1178605a7404b3ca81551f0d17b18269c1b8e3ed9dba919519bf5615760219040343e5a5ad3835c10bcada465c24ba033b85acb9ae17973a3064efa81876a3c2b53453e82e68bf4259cfeeaa55164f396c6f7a9530f38b52cea5c04b3e738444057f47cf97b5f350388da6b5d7be3c947c529a1dc581523c13127fecd38f0dd6c738eda6fb8b51c07313c09d77d988fdf59b622ab08622b62faa9f4891548e286f447e86468822bac8660bd6170f06760b9dd3dab6b360925cec8b8d27de9aa0ca5e86aa6f3ba122b646aea04ffe7dfc978d7c55690732d7bd0f766324a11223dd308c3017006b55beb2e24ba0a7dd1fb168621ccbe918745080fa179029e0abf603ead717b19356ec3f40ffed11f6f5a25988eca970469e2f1f45ec39d7da4ecaf1593e620907033337f25e80a920887f60f96b5cc30a27089b3e2e308a41953f2ca85afea0fa28d224558c2b23d8b60dc3e5cf9a8f270013ff2f9b8bfa5380cc5e5d5e20ae2c4f946fc5da166de69a326c21e79577e6e73cc0dbc47ee343b50ccca162388bfe28ccb043e83054721d26e7a2eb1a83687e5febd5710a2c5ceeadde0ff734deace60205df4ab315c7e1e3da80da84cad1c60f9db227b6eb6b28ab6279ee0b02bc6b147bf1b3eef02363c045342872073dfe37eb1fa4c49c373a7b2e7a51998fc4c440edd44ede056c2af0bdfadc0b375ef773692958690746833142bd34acc80fb4eabe9ef4c6ddb828103eddb7fba9bf5c02e9613661b4e723c4ea915274b66152c0d16b926347b3f1e0f446e39de45b5e04a63bf4c4a2fc72863bfb1d99d1daba6b2b752114a88c6cdecfaa590732a8d89560834bf764f10e7766f7fc77e25f89b9d443a9baaddcc8cfcaf40a2f444d7460d520f76fd3e6a075937b81940abb00415f30289f7a82dc69d6d60708af0f3cf6ad9ec058d645ccc69b5db746e9eeab8caf06972f09418045002080862f6d257cb5a2f14d7d4a3b0fe99947457936338365b5aef1b83ae739cde92df1195ecd8085c8bd754399891c28185dbcfd697edcc04706788cf7906a920128f0fff3ecdc37f1d6f1149f90c722fabd69291cab71f8cc64b24df1cbe81b13164d0a1fa2fb603a38524d0451fd6ff3a11dfef74cc1f8eea2d3f95cd01ffd96ef9a25017fa99e7f6643aa11e3a70217f3e5e5ab535d6dacc3dd696aec2e47c5eb943f12df86f40a64b6caebfe704259304194e7ac35e3171f06c5fa4aa490fde108d7931c0b2fdc1681605048d93dc3ef60a35efb1c4f70c195f2bb919a817cfd0ea1302f2e28b400004c7c9355ee84ac602506aac6cc0d06ea32a49cf024bb79ac038ba6d51677e51b60d8548d234411df5d6ead39eebb36f55b714fa7ea2f6d3b13214104e26af239fcbd8b3b7b204cd8dc4124a8a97142f647b06ba7198cba6d73aec0ca099b43981281833e153814bd805b5520e96b11882f26bb5b2dcaa46c04bc4fcc90312964962d31ce6fb5707cd8b6f02f757286c91dd97d1c3545239dd0e70a76b7ff7f33c7c1736969813af93de913dc21a5b32c69effd383b5ab952394b84305e283207610b430e569571dcd19825cefc9d63670cfdd0dd33c676ddc8c8a3907a9a6d6dce470921479f3d4a4951a0ba5068622e266ca31ea635b2952e62612999a4247e74efbd063737c45a569cf16adbd677fd2604d668d30ab23b9184ccebb680aee6bafa255d02d38aeea38ef5ad377351fd4f575204a69af3aad2a1aee383fce615c082a26ed92a40c842326712ebb14f5a251dfd98cf03e64d3239a4fa37982250c09e9d1f62c1ab5d4e67429d9d1626236b7dbdaad0039be9d682667fc8bd56a6c840b58910fe11b65d95ead4a91953293bdefba47ffa12cfb4d7d07fe8709be17c76f82d452bb9b5cc318da270d403cbc95253cd871a662d49461b55173ce8703d0b492b7870e8319977e5d85844b0d8ee2bb7e398d52d85b06d0a770317659a65323164bc812c7c6eee79dcdae2226090715f01d6403b0ef76e76d46fb8ddb04305a41d72796eb6d5a8fd052de8059810bedbaefd423d5ea775f32ea5283e8440bd60d69e6983210e23e64e10d7f8eec15892edd5b966db4de10e32383aa91687828477bfa4dcc91a09b5e461410ac259f84b7ee669fae38c5197e72f62d522e9b95ab195c430034ff5b31f1724294c5570c5b9ae42852b7754fc5fdae339897e19cb17651b6ebf95ed1d93d094336ba1ae623ce0171df93bd668a3267a240eca500cabfeafbe0f228cc91d390c1b4344b86d6c53f1e42d4005c99d4f366a65714e2a7120da9aa782f6ad3e810e06272042e24be563652d75da2d4a770e81a58df8ea6646b76348f5643264d95019a8b10e1f9f1a2fff39c4d5a3f9f9fd05aab3445eb956c541ebf6be97b9405e0ed26dc7f14b09aabc4fda0a51011bf9bd218f737159669deb5a0714d8d1d6b1bdf54b2a5e7be2a1a698874f92c3ad7bd2337d2694341f13c986396e6e553ac11d1711261f93d661659a3a6a2f37e3a67f1c215f8c2f29a6b79c086ac43e24ee632f3acab686b4869443ca51bf5b7663b76871801919a25e96cfeb86d572d9013165c924d3f4a3eb65eb82ebcc553d40233ebe09b183a4ec9b3cd07fb5303f025da340d35e654513cca8c5616cf8a34646dfcdec9d6d5fcf3160b703c5395605463bf57e2af6956d26bf976feed8c48438ed294340e6e4d22b6b2937e37aaf5b072c45d9c105570900f94fb29d8a9b1eca762002ef01ca991017c1967a64603dd234fba8afba4704780d1567e28dd049ef9d970a9baae3446d9750fd68b1a996e6052c9f9598a3b8e2511021eafe82485cbd28fce5aefd2497efce5e4e95b919955ebfc4979c44c9712091da9e9884d432aae0ba95889156dc65865342f030a97deaa4944efa9a57f64a69d8000e673f45bb04ed68662472f341d676f730e39c3ad0bc821cc40b71184173a41a7e395e410ed5f99d56fe9ca0f7f1ef3fb7dfce9b60ee467c19cc4a689c901215122f3d9d347d6492285b25c51e417f84334682fd586902cb9e9aea2e0de6efc6c083d53481f6370655ff9e54cff3ed4789cb72dc61d752bee7d6c050947134ca83ec7af0b451948bde87e47a34aa1ccd63eae79ec1eccf398b3c5abd9dd1509b37deb93793b82bbd251d9bbe286fc20dbd83f767fd45606f8c7581b5fcbc3c80bc91a8b94e003eb539501b7b150c53b08876a344162cb4237a790fc94c5c8ea98c3a5f5999dc58b0cb1bc44c60974a08956180ab78a95699a051aec2f8f1aa0c1c4311f5a216b310388081b1f91a243f41a39530c1306175fe755ff1e1e1af1c5a7be6036f0eaa2b5da44eec0cf9b95ffb4cbb218c8b5434d77d1f8a8eacfe6871020a94b554e00265114e085d0b4a86aeeeb6cd4e2efdaede19e4a63daf1076ebbf6742d3d9d674ea9e26803480b19c338e24f4272f4371250f0a92aeda926fbef1782f6ef71bb9e15b948537019f5fc25b8c9449c6e2a8034c6180c37465477d001f57e8548fb7a3e97ee5e02e3c71719d1cc4f3796753134ec2a9fe75195a8721f7067af34458c4b715d0f8e3679f9fbd6df80565550b30ed07dcc44223f17d90decc4147278f70a8655e0882147d32dde9022efea57d50b5a650a43b4642931222b65a98a603cb6f09b0cee7e29ce7ac71f577f714ac14142a3d428d84f8836eacb64b127f7d6cbe5d391cee3477e1c30d8d6715af41dc93f901d80dc29ae9565609e2838d6f4b87279fef3faffd8c949229a072efda578c8f12793954183a52072322109fee8b037b22034c633afff05512a74588e19e4cef0916e36ddcde6aa186fca0659fece29e3c5ed52b439337a3afda04d8b58adf463a3811423d254047839ebdd24e4bddd6916282d2c293140ae52458681953ea415e6f3292cabbe734807b41ffa8bd8a75af9b3261c9dc98edce725c11f0855f9795dfe77603269d7663d6732a0dd73139d63c40a524a50b3af8f6635c3b57b27578ea9f788103ff39d72ef5e707485f70d6ae62d935ec519b67ff1c98bdd2f4b2c154a892b58155ef499536fa14614c2f7e5107e8f8e1cb29eb30f303f60fbcac1d30208be9037577b36718a44c4c64a327fd6063d8a275fa273415353e63201ca011e710d0c6ffd712ef2458bc9e88dff663bde9cb98561d49af56cd604983a5c248525b5f95454ed63fceb5209d8a77cb0953b203b03eabf7bbe3b49e1b003954284cf6528394f5139ff8bd33c101d9e0339de269691b9b0d6680d29771de115ea12a97f1239c5ff3f0962da211bec3cfaa10cf20a5fa7a9224b00008f2cc7144bc2d7f6321eb07cb8e279cbfbacc4cf9fdccc574840b1d485d7186918101ab2f1d7cfb260cb032fcae3fc116f79824083304ada9964b301b71251f5e093852fd5a4fe7fce73973dfa0a36589a2ea6ca89296238b0e8c2b6637b799bad5d65dd6f7ecd97e9b6cf9b0a6cbf63505a6e9a3b09cfa3c0c515b1dd878c6f6baa62b65ab61e41d5161567c2adfb060c0680c7751e80608905519267a9b1eff4b902569c55bb994a9377ca6d553af87ada8ceb446c1d3de8bdecf5fa98064e6fbbab09a1221314d6e6fa13726a3a2b111e509c60d7002397fe3804203e4c40e753d4b5047f5a72cfd55720b69016aa3d845c0baa0797b28b4d87e7ff2756cda13e0cebecee1d411ff2d1b02b5200d3554f93d2e1c97ad7b9b1711c81a0b0f83c42fd8b638ebb891a31eaee368102d367a3e00e0694dcd7fabef052269012f71db09fd54198293deb007b7f9687096aeb30e31dbcb1a75ccd2d3a75e7eaf3db6b560dbcfae9302972bdc3c5016d44fce027c2d2c809a48a6e1fbcd29e38338cda0114e1dd1904f5ba21076175ba9b6b3ae0dc54a1eb195514e6a92e90bf1baf481978f6bb4347cd6149a9fe2bf86b8ce74c434bb2e16334a2f9453c8993a9c43e2431fb5c937f83ddf95b81585d6500aca7ce946a74ff4c25a058da402a16c0f1b4954f6a4b3f254ac4023f728787f9353950d29d385f48cd7e6bd5957352171612126bc95aee23622b63ab0b8459c82f11a5283c942839ed385cfa0c9e3d94242b6a09bd7c59edabba5fd854819e48e0909091c1b57ca871b69ec3f09b93a63718f806dbb05ac8242798932f16a1f4697bfd1fe3eda9258afa5e6964058aeb83baa0f769739dfee50a2d53d1fef8674d9e56586179c2d7b6d7554371b7bdcb0388a732b872fc71ff3d8cad1cbbf90afb6a108eed7dfa6065cff0dabc11077d33a5018357b8903ea463673d320d12d8b8ff5c4372b6837785f8b2c5244c349686afa3b28ed9eb626b3fe389981dae646d7ace1aaa6b8bbfe628de4974bc7c85a453eba1c757903fa3c2d30a1e0cf578fa50c532665ec04bec22d103d25f16d21b820df302e1709ec435be4b8cca9f74e66322a6e5fa62ada05cbda43990874f19ce85f7fd837e33e321e99865896d243453d45fc15a8f4caca9d7091b4a052af4122303eec0495b4fe6e35edd318999f60bb0a26bdb8d99b1e79bbf7899abf6887e056eca06032e4ba4e100727999626412f1d3e178740cf0c677ec59c33a2c39a8f1836a4ff2a37dfe001e60bba15a504023b2e924383404c7969e0b0a0158dc8bd0c0eed549bdcd4d18c3177537a99a420f7198d2fcffdf91ad983588828fb295212f2a7ce1e982e95fd9c25613b03e8e22312db2f9f6c6974456e3b218404b8136d43414f3dc200ec6994c1f718d6ab574486279ff923cea6d9a5d812cf4bffdff985f7c90dbbaeb7e3d5c9b6cdcf9ae7c7f7b4c17a6c9ff1685f844c24f7b9b6e1493a0e6a6685a959e90ed2690292a647ac36400fba0bce6834da10a0addc7cc62ef3056a144153f364c19ecf4f72197f3a123915a76104ef3642b88bed1a877190ea1fe94e7c083ff737fc13fdc154ba3e7276160248736c284879d71e1625a142deb560eccc87643350fac0626335f089d965ff2a2d21166851f2186baae076f239b3cc720c2d971cb02e6eccb7dfb699164bb643c54f4cf54ef8cb678abbbc56d8cd681a99f9ace889518d708e923aaf2710d069a5872d2394822fc00884cd622f8b31a89ebddcff17daf4e334e20cd520b4ef456df334bf72b20b24e3dcd4fe38209e38286bbd780d14ce21ee68e02331c6e085ffbc907f015e65c173703b913d0cdd6d06a3b16ba9f1155801286d1d990889c92419a17432e98f8e3e5a67d27bbe0999383a188ce8b8aed0ded3606b34361c363d5a5bc8d8ca69d995f91a4b75c17b8dbc1c9ef91dea1479be3d39bd1e7db51de8c812ce0870f64a37cc53f185dde53802fcbd39d1732d20de3cac6a023b516747b964cc3041a4c540c680e6ca6971f0ddacc4c7cbb5e37ce60d50c799f93739e0039f82f94a72b14eff093c796e6e30e28b940891a410c19f442eb8d32b2fd1c3c6a3c8f6f4dd9afb7eac1a3574fd9f189e82b7d80d93ccfcc30909c98c77f658185c7e0b9569f892a99f286dea08e1a5f26be560176137432b8e1b115d4f8b9038da9da1bf15702291dfa533591e49fb006bd86118a6ba10ced1f5e1e3f368713ef571254da674c9c1d5a131e946b621bcb0efeac2f09c85365f60265b7b0892f875588b9870460495f0574db9a86466f729e65eeeec4a4655048d81f2922376c59ae0c8328b6100be4958fe8641e1024efc69964fb67cd117b563b4c68e7ff809c14f8e41316ba16d39e72d7b585b7ac169a6f3fc4e3f0906cc9c0d7f897c1643eab03bb2e697c0b50a919d633fdb196f8492bf768b7543bdf39ec496e2e57e7038a9ed6e11c3bd2cdf881ee326cb56fa25e0266c0943c3ce7fffea080f60c1b79e20d0cff90f61535ff564a839c68508114618645b5f78a886d80bd7b7d4f511c1420b686a70d3511ff8ce312688ac4e076ce2ad6338e0d2fa269c4c393a0684c39f151ef199419f43e112431bc2392dae7e193f550eb0a2753de8515093f8467e320abd382167b4eb3eb4c434ce84217880977008dafe41ad987e5a4c48d43eeaacea9120c2c8a97be7192e7592e9cc5fd48facbf3098283ce59f6803edb4fc3e8cd493318e970ae532d31a6155cad8900c6b0024132354a5588b07564429630f450b4a0bd140813c24b80b9fec5853863c2e04c9d2f614486befc9797c44a5a63c829aeeb65c47ce3fdc849da23a7dd6fba74a03e92deb01bb5224cdcd2a3b8a2cc693cda95e95aa12257e2531bb6e2a87b2f42e1cbabd332b0e232765e659c9141e8736b0339430a9e5de7920eab14d8d5dfea6abc7d42bdc275dd128e2d726ab56faf784645dbc1edd8d7b9e1e7e7201a5cae49ad385aa0d0c24104aa26403c7740444839f64ab4035633fcda7c24d9a02df78496164b02c4e7346f673493b42f2f0839e28f483429be3c6cf1fb7c73f65fbf9454e9d18fab4c9f1dbfb212f6692ae32fb9a4724e870632d45f1ba33caae28f14cb98f1559a0b7fcf694eeb55fa5111c9822cfb2c6d1362df5e2cd3b20d1e311bafbc288330ba64015fcd5d90aa509fca1a0bc0a4c427c54eae75cd4050e990c25c5e8df03b0813bb06ba7a37ed56805fed9989b424701b6a7d96a8f24176ab675e9a02fa56b48c842686ef8a4b178fc6e4813878fd70bc1c22d1dc9527816aee6ad3ca3b4ba4d597c0c2318630aadecd40e982e984b9af4dc0c66351b5f3b169e264529cbb816c28edcca60cb8ef7cea5b9954edcea892f4b994a9b2c9b87ef8161f27f8c7dcbfa8de8b5858c56aadf607db081efd890d3a191368eb49d656d423850031ad91e77dd64964f681d903dff5bac86b1ef9f66c8ca6c043c47ace85fde62acd50c794a4bf17e2db6a054eb2a3230d4a1655bbb2df669ce0a2284ff7d550d28e35d825e1bb3ac35f058e66278b00e016c01baea9279b08eaf1223b3eedb8c1e03cc40ac14bdc8ddbf16ec98d19ce33f407e3cc75c9cc4fef9c09684ad6dbcadcf2b87981661742b7cf58207f4c1e1ff469cc9a78cf1f9f1b49411a6b540d9531f2bb15952b14dde0065574a',
        type = 'pvdata',
        signObj = `update backup file${originCt}for${did}with${key}type${type}`,
        sign = tokenSDKServer.sign({keys: privStr, msg: signObj}),
        signStr = `0x${sign.r.toString('hex')}${sign.s.toString('hex')}00`
        isok = tokenSDKServer.verify({sign})
    // console.log('sign', sign)
    // console.log('signStr', signStr)
    // console.log('isok', isok) // true


    tokenSDKServer.backupData(did, key, 'pvdata', originCt, signStr).then(response => {
      console.log('response', response.data)
    }).catch(error => {
      console.log('error', error)
    })

    res.status(200).json({
      result: true,
      message: '',
      data: ''
    })
  })
  .put(cors.corsWithOptions, (req, res, next) => {
    res.send('put')
  })
  .delete(cors.corsWithOptions, (req, res, next) => {
    res.send('delete')
  })

// 得到pvdata
router.route('/getPvdata')
  .options(cors.corsWithOptions, (req, res) => {
    res.sendStatus(200)
  })
  .get(cors.corsWithOptions, (req, res, next) =>{
    // res.send('get')
    // 解密
    let {didttm, idpwd} = require('../tokenSDKData/privateConfig.js')//.didttm.did
    let priStr = JSON.parse(tokenSDKServer.decryptDidttm(didttm, idpwd).data).prikey
    tokenSDKServer.getPvData(didttm.did).then(response => {
      // console.log(response.data)
      if (response.data.result) {
        let pvdataCt = response.data.result.data
        let pvdata = tokenSDKServer.decryptPvData(pvdataCt, priStr)
        pvdata = JSON.parse(pvdata)
        // console.log('pvdata', pvdata)
        // pvdata.pendingTask = {}
        // let ct = tokenSDKServer.encryptPvData(pvdata, priStr)
        // console.log('ct', ct)
        res.status(200).json({
          result: true,
          message: '',
          data: pvdata
        })
      }
    }).catch(error => {
      console.log(error)
      res.status(500).json({
        result: false,
        message: '',
        data: error
      })
    })
  })
  .post(cors.corsWithOptions, (req, res, next) => {
    res.send('post')
  })
  .put(cors.corsWithOptions, (req, res, next) => {
    res.send('put')
  })
  .delete(cors.corsWithOptions, (req, res, next) => {
    res.send('delete')
  })

module.exports = router;
